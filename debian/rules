#!/usr/bin/make -f

export PYBUILD_NAME=pt_os_web_portal
# Override default 'python3-pt-os-web-portal' behaviour
# which comes from building multiple binary packages
export PYBUILD_DESTDIR_python3=debian/pt-os-web-portal/

%:
	dh $@ --buildsystem=pybuild


override_dh_auto_test:
	# Don't run the tests!


override_dh_auto_build:
	cd pt_os_web_portal/frontend/ && \
		npm config set prefix ~/.local && \
		npm install -g yarn && \
		~/.local/bin/yarn install && \
		node_modules/react-scripts/bin/react-scripts.js build

	dh_auto_build

override_dh_clean:
	rm -rf \
		pt_os_web_portal/frontend/node_modules \
		pt_os_web_portal/frontend/build

	dh_clean

override_dh_installsystemd:
	dh_installsystemd --no-stop-on-upgrade --name=pt-os-web-portal
	dh_installsystemd --no-enable --no-start --name=pt-os-web-portal-port-busy
